<!DOCTYPE html>
<html lang="zxx">
<head>
		<title>Infinilist</title>
		<meta charset="UTF-8">
		<meta name="description" content="SolMusic HTML Template">
		<meta name="keywords" content="music, html">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Favicon -->
		
	
		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i&display=swap" rel="stylesheet">
	 
		<!-- Stylesheets -->
		<link rel="stylesheet" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" href="css/font-awesome.min.css"/>
		<link rel="stylesheet" href="css/owl.carousel.min.css"/>
		<link rel="stylesheet" href="css/slicknav.min.css"/>
	
		<!-- Main Stylesheets -->
		<link rel="stylesheet" href="css/style.css"/>
	
	
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	
</head>
<body>
	<script>
		function loadUser(id){
			//event.preventDefault();
			let xhr = new XMLHttpRequest;
			xhr.open('GET','/api/perfil/'+ id);
			xhr.setRequestHeader('Content-Type','application/json');
			xhr.send()
			xhr.onload = function(){
				
				let databoy = JSON.parse(xhr.response)
				let usrN = databoy.nombre + ' ' + databoy.apellido;
				let usrC = databoy.correo;
				var sx;
				if(databoy.sexo == 'H'){
					sx = "Hombre";
				}else{
					sx = "Mujer";
				}
				let usrI = databoy.url;
				document.getElementById("userData").innerHTML = `<h3>${usrN}</h3>
			<br>
			Correo: ${usrC}
			<br>
			Sexo: ${sx}
			<br>
			Numero de listas: 0`
				document.getElementById("userImg").innerHTML = `<img src="${usrI}" alt="John Doe"   class="fa fa-align-center " >`;
			
			}
			

		}
	
		loadUser(localStorage.currentUser);

		function login(){
			event.preventDefault();
			let datosLogin = {correo:`${document.getElementById("userCR").value}`,password:`${document.getElementById("userPASS").value}`}
			let xhr = new XMLHttpRequest;
			xhr.open('POST','/api/login');
			xhr.setRequestHeader('Content-Type','application/json');
			xhr.send(JSON.stringify(datosLogin));
			xhr.onload = function(){
				if(xhr.status == 200 ){
					console.log(`Welcome ${document.getElementById("userCR").value}!`);
					localStorage.setItem("currentUser",xhr.response)
					document.getElementById("bod").innerHTML += `<div class="alert alert-success alert-dismissible fade show" role="alert">
  																<strong>Holy guacamole!</strong> login succesful.
  																<button type="button" class="close" data-dismiss="alert" aria-label="Close">
    															<span aria-hidden="true">&times;</span>
  																</button>
																</div>`;
					location.reload();
				}else{
					console.log("Error de autenticación");
					document.getElementById("bod").innerHTML += `<div class="alert alert-danger alert-dismissible fade show" role="alert">
  																<strong>Whoa there!</strong> something is wrong here.
  																<button type="button" class="close" data-dismiss="alert" aria-label="Close">
    															<span aria-hidden="true">&times;</span>
  																</button>
																</div>`
				}
			}
		}

		function register(){
			var sx;
			event.preventDefault();
			if(document.getElementById("box1").checked == true){
				sx = "M";
			}else{
				sx = "H";
			}
			let newSer = {nombre: `${document.getElementById("nombreUser").value}`, apellido: `${document.getElementById("apeUser").value}` ,correo: `${document.getElementById("correoUser").value}`, password: `${document.getElementById("passUser").value}`, url: `${document.getElementById("imgUser").value}`, sexo: sx};
			let xhr = new XMLHttpRequest;
			xhr.open('POST','/api/registro');
			xhr.setRequestHeader('Content-Type','application/json');
			xhr.send(JSON.stringify(newSer));
			xhr.onload = function(){
				console.log(xhr.status);
				if(xhr.status == 201){
					console.log("Nuevo usuario creado con exito");
				}else{
					console.log("No se pudo crear el usuario");
				}
			}
		}

		function editUser(id){

			let updator = {nombre: `${document.getElementById("chN").value}`, apellido: `${document.getElementById("chA").value}` ,correo: `${document.getElementById("chC").value}`, url: `${document.getElementById("pfp").value}`};

			let xhr = new XMLHttpRequest;
			xhr.open('PUT','/api/editar/'+ id);
			xhr.setRequestHeader('Content-Type','application/json');
			xhr.send(JSON.stringify(updator));
			location.reload();
		}

		function logOut(){
			localStorage.currentUser = "";
			location.reload();
		}
		


	</script>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header section -->
    <header class="header-section clearfix">
		<img class="mt-4" src="img/logo.jpeg" alt="logo">
		<div class="header-right">
			<div class="user-panel">
				<a href="" class="login" data-toggle="modal" data-target="#login">Iniciar sesión</a>
				<span>|</span>
				<a href="" class="register" data-toggle="modal" data-target="#regis">Crear cuenta</a>
			</div> 
		</div>
		<ul class="main-menu">
			<li><a href="index.html">Pagina Principal</a></li>
			<li><a href="playlist.html">Mis listas</a></li>
			<li><a href="profile.html">Mi Perfil</a></li>
			<li><a href="contact.html">Contáctanos</a></li>
		</ul>
	</header>
	<!-- Header section end -->
	  <h1 class="ml-5 mt-5 mb-3">Perfil del ususario</h1>
	  <div id="bod"></div>
	  <div class="container ml-5 mt-3 mb-3">
		<div class="row media border p-3">
	  
		  <div class="media-body  mt-3 mr-5 col-3" id="userImg">
		
		  </div>
	  
		  <div class="col-8" id="userData">
			
		  </div>
	  
		  <div class="col-2">
			  <br>
			  <br>
			<button class="btn btn-primary mb-3" data-toggle="modal" data-target="#Jedit" type="button" >Editar perfil</button>
	  
		  </div>
		</div>
	  </div>
	  <div class="col text-center">
	  	 <button type="button" class="btn btn-primary mb-3 center-block" onclick="logOut()">Cerrar sesión</button>
	  </div>
	
	  
	  <!-- Modal -->
	  <div class="modal fade" id="Jedit" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content">
			<div class="modal-header">
			  <h5 class="modal-title">Edición de usuario</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				  <span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
			  <div class="form-group row">
				<div class="col-6">
				  <input type="text" class="form-control" name="nombre" id="chN" aria-describedby="helpId" placeholder="Nombre o nombres" value="John" required>
				</div>
				<div class="col-6">
				  <input type="text" class="form-control" name="apellido" id="chA" aria-describedby="helpId" placeholder="Apellidos" value="Doe" required>
				</div>
			  </div>
			  <div class="form-group">
				  <label for="correo"></label>
				  <input type="email" class="form-control" name="correo" id="chC" aria-describedby="emailHelpId" placeholder="Tu correo" value="jdoe@test.com" required>
			  </div>
			  <div class="form-group">
				<label for="fecha"></label>
				<input type="date" class="form-control" name="fecha" id="fecha" value="2000-01-01" max="2019-12-31">
			  </div>              
			  <div class="form-check">
				<label class="form-check-label">
				  <input type="radio" class="form-check-input" name="se" id="sx1" >
				  Mujer
				</label>
				<br>
				<label class="form-check-label">
					<input type="radio" class="form-check-input" name="se" id="sx2" checked>
					Hombre
				  </label>
			  </div>
			
			  <div class="form-group">
				<label for="pfp"></label>
				<input type="text"
				  class="form-control" name="pfp" id="pfp" placeholder="URL imagen de perfil" value="https://randomuser.me/api/portraits/men/26.jpg">               
			  </div>
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
			  <button type="submit" class="btn btn-warning" data-dismiss="modal" onclick="editUser(localStorage.currentUser)">Editar</button>
			</div>
		  </div>
		</div>
	  </div>

	  

	<!-- Footer section -->
	<footer class="footer-section">
		<div class="container">
			<div class="row">
				<div class="col-xl-6 col-lg-7 order-lg-2">
					<div class="row">
						<div class="col-sm-4">
							<div class="footer-widget">
								<h2>About us</h2>
								<ul>
									<li><a href="">Our Story</a></li>
									<li><a href="">Sol Music Blog</a></li>
									<li><a href="">History</a></li>
								</ul>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="footer-widget">
								<h2>Products</h2>
								<ul>
									<li><a href="">Music</a></li>
									<li><a href="">Subscription</a></li>
									<li><a href="">Custom Music</a></li>
									<li><a href="">Footage</a></li>
								</ul>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="footer-widget">
								<h2>Playlists</h2>
								<ul>
									<li><a href="">Newsletter</a></li>
									<li><a href="">Careers</a></li>
									<li><a href="">Press</a></li>
									<li><a href="">Contact</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<div class="col-xl-6 col-lg-5 order-lg-1">
					<img src="img/logo.jpeg" alt="">
					<div class="copyright"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></div>
					<div class="social-links">
						<a href=""><i class="fa fa-instagram"></i></a>
						<a href=""><i class="fa fa-pinterest"></i></a>
						<a href=""><i class="fa fa-facebook"></i></a>
						<a href=""><i class="fa fa-twitter"></i></a>
						<a href=""><i class="fa fa-youtube"></i></a>
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- Footer section end -->
	
	<!--====== Javascripts & Jquery ======-->
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/mixitup.min.js"></script>
    <script src="js/main.js"></script>
    
   
	<div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <form enctype="text/plain"> 
                <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Login</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="form-group">
                          <label for="mail">Correo</label>
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">👤</span>
                            </div>
                            <input type="text" class="form-control" placeholder="Correo registrado" aria-label="Username" aria-describedby="basic-addon1" id="userCR" required>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="contra">Password</label>
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon2">🔑</span>
                            </div>
                            <input type="password" class="form-control" placeholder="Contraseña registrada" aria-label="Username" aria-describedby="basic-addon2" id='userPASS' required>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer w-100.d-flex.justify-content-end">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" onclick="login()" data-dismiss="modal">Entrar</button>
                </div>
                
                <small class="mb-3 mr-3 nav-link" data-toggle="modal" data-target="#regis" data-dismiss="modal" style="text-align: right;">¿No tienes cuenta? <a href="">Registrate aquí</a></small>
            </div>
            </form>
        </div>
	</div>
	
	    <!-- Modal -->
		<div class="modal fade" id="regis" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<form enctype="text/plain">
					<div class="modal-content">
							<div class="modal-header">
									<h4 class="modal-title">Crear cuenta</h4>
										<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
										</button>
							</div>
					<div class="modal-body">
						<div class="container-fluid">
							<div class="form-group row">
								<div class=" col-6">
									<input type="text" class="form-control" required id="nombreUser" aria-describedby="helpId" placeholder="Nombre o nombres">
								</div>
								<div class=" col-6">
									<input type="text" class="form-control" id="apeUser" aria-describedby="helpId" 
									placeholder="Apellidos" required>
								</div>
							</div>
							<div class="form-group">
								<input type="text" class="form-control" id="correoUser" aria-describedby="helpId" 
								 placeholder="Tu correo" required>
							</div>
							<div class="form-group">
								<input type="password" class="form-control" id="passUser" aria-describedby="helpId" 
									placeholder="Contraseña" required minlength="6" >
							</div>
							<div class="form-group">
								 <input type="password" class="form-control" id="confirmUser" aria-describedby="helpId" 
									placeholder="Confirmar contraseña" required minlength="6">
							</div>
							<div class="form-group">
								 <input type="date" class="form-control" id="fechaUser" aria-describedby="helpId" 
									placeholder="01/01/2000" max="06/08/2000" required>
							</div>
							<div class="form-group container">
								<input type="radio" name="sx" id="box1" value="M"> Mujer
								<br>
								<input type="radio" name="sx" id="box2" value="H"> Hombre
							</div>
							<div class="form-group" required>
								<input type="text" class="form-control" id="imgUser" aria-describedby="helpId" 
									placeholder="Url de imagen de perfil">
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary border" data-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-primary" onclick="register()" data-dismiss="modal">Registrarse</button>
					</div>
					</div>
				 </form> 
			</div>
		</div>

	</body>
</html>